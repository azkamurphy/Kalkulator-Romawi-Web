<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Kalkulator Sederhana</title>
  <style>
    body{font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:#f4f4f4;margin:0}
    .calculator{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.2);width:300px}
    .display{width:100%;height:50px;font-size:24px;text-align:right;margin-bottom:10px;padding:6px 8px;border:1px solid #ccc;border-radius:8px}
    .buttons{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    button{font-size:18px;padding:12px;border:none;border-radius:8px;cursor:pointer;background:#eee}
    button:hover{background:#ddd}
    .span-all{grid-column:1 / -1}
  </style>
</head>
<body>
  <div class="calculator">
    <input id="display" class="display" type="text" disabled />

    <div class="buttons">
      <!-- row 2 -->
      <button onclick="appendSymbol('1')">1</button>
      <button onclick="appendSymbol('2')">2</button>
      <button onclick="appendSymbol('3')">3</button>
      <button onclick="appendSymbol('+')">+</button>

      <!-- row 3 -->
      <button onclick="appendSymbol('4')">4</button>
      <button onclick="appendSymbol('5')">5</button>
      <button onclick="appendSymbol('6')">6</button>
      <button onclick="appendSymbol('-')">-</button>

      <!-- row 4 -->
      <button onclick="appendSymbol('7')">7</button>
      <button onclick="appendSymbol('8')">8</button>
      <button onclick="appendSymbol('9')">9</button>
      <button onclick="appendSymbol('*','x')">x</button>

      <!-- row 5 -->
      <button onclick="clearDisplay()">C</button>
      <button onclick="appendSymbol('0')">0</button>
      <button onclick="appendSymbol('.')">.</button>
      <button onclick="appendSymbol('/','÷')">:</button>

      <!-- row 6 -->
      <button onclick="appendSymbol('(')">(</button>
      <button onclick="appendSymbol(')')">)</button>
      <button onclick="calculate()">=</button>
      <button onclick="appendSymbol('**','^')">xʸ</button>

      <!-- row 7 -->
      <button class="span-all" onclick="convertToRoman()">ROMAWI</button>
    </div>
  </div>

  <script>
    let calculation = "";
    let calculationDisplay = "";
    let isResult = false; // penanda apakah terakhir hasil

    const $display = () => document.getElementById("display");
    function setDisplay(text){ $display().value = text; }

    function appendSymbol(symbol, displaySymbol=null){
      // kalau sebelumnya hasil & tombol angka → reset
      if(isResult && !isNaN(symbol)){
        calculation = "";
        calculationDisplay = "";
        isResult = false;
      }
      calculation += symbol;
      calculationDisplay += displaySymbol !== null ? displaySymbol : symbol;
      setDisplay(calculationDisplay);
      isResult = false;
    }

    function clearDisplay(){
      calculation = "";
      calculationDisplay = "";
      setDisplay("");
      isResult = false;
    }

    function calculate(){
      try{
        const result = eval(calculation);

        // bagi 0 -> undefined
        if (!Number.isFinite(result)) {
          clearDisplay();
          setDisplay("undefined");
          isResult = true;
          return;
        }

        calculation = String(result);
        calculationDisplay = String(result);
        setDisplay(calculationDisplay);
        isResult = true; 
      }catch(e){
        clearDisplay();
        setDisplay("Error");
        isResult = true;
      }
    }

    function convertToRoman(){
      try{
        let n = Math.trunc(eval(calculation));

        if (!Number.isFinite(n) || n < 1 || n > 3999){
          setDisplay("Angka tidak valid");
          isResult = true;
          return;
        }

        const romanPairs = [
          [1000,'M'],[900,'CM'],[500,'D'],[400,'CD'],
          [100,'C'],[90,'XC'],[50,'L'],[40,'XL'],
          [10,'X'],[9,'IX'],[5,'V'],[4,'IV'],[1,'I']
        ];
        let res = "";
        for (const [val,sym] of romanPairs){
          while (n >= val){ res += sym; n -= val; }
        }

        calculation = String(Math.trunc(eval(calculation))); 
        calculationDisplay = res;
        setDisplay(res);
        isResult = true;
      }catch(e){
        setDisplay("Error");
        isResult = true;
      }
    }
  </script>
</body>
</html>
